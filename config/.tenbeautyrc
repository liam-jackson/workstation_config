#!/usr/bin/zsh

##################################################
############## Paths to Directories ##############
##################################################

export TENBEAUTY_PATH="${WORKSPACE_PATH}/tenbeauty"
export TENBEAUTY_DIR="${WORKSPACE_PATH}/tenbeauty"

export AARCH64GCC_DIR=/usr

export PYTHONPATH="${TENBEAUTY_PATH}:${PYTHONPATH}"

##################################################
############### Alias Definitions ################
##################################################

cdt() {
    if [[ $# -gt 0 ]]; then
        cd "$1" || exit
    else
        cd "${TENBEAUTY_PATH}" || exit
    fi
}
_fzf_complete_cdt() {
    _fzf_complete +m --reverse --border --ansi \
        --preview 'exa --all --tree --level=2 --color=always --icons {}' -- "$@" < <(
            fd --type=d --hidden --max-depth=1 --no-ignore --color=always . "${TENBEAUTY_PATH}"
        )
}

function cdvp() {
    if [[ $# -gt 0 ]]; then
        cd "$1" || exit
    else
        cd "${TENBEAUTY_PATH}/vision_pipeline/" || exit
    fi
    conda activate vision
    clear
}
_fzf_complete_cdvp() {
    _fzf_complete +m --reverse --border --ansi \
        --preview 'exa --all --tree --level=2 --color=always --icons {}' -- "$@" < <(
            fd --type=d --hidden --max-depth=1 --no-ignore --color=always . "${TENBEAUTY_PATH}/vision_pipeline/"
        )
}

function cdvr() {
    if [[ $# -gt 0 ]]; then
        cd "$1" || exit
    else
        cd "${TENBEAUTY_PATH}/vis_pipe_ref/" || exit
    fi
    conda activate vision
    clear
}
_fzf_complete_cdvr() {
    _fzf_complete +m --reverse --border --ansi \
        --preview 'exa --all --tree --level=2 --color=always --icons {}' -- "$@" < <(
            fd --type=d --hidden --max-depth=1 --no-ignore --color=always . "${TENBEAUTY_PATH}/vis_pipe_ref/"
        )
}

function cdvhc() {
    if [[ $# -gt 0 ]]; then
        cd "$1" || exit
    else
        cd "${TENBEAUTY_PATH}/vision_hardware_control/" || exit
    fi
    conda deactivate
}
_fzf_complete_cdvhc() {
    _fzf_complete +m --reverse --border --ansi \
        --preview 'exa --all --tree --level=2 --color=always --icons {}' -- "$@" < <(
            fd --type=d --hidden --max-depth=1 --no-ignore --color=always . "${TENBEAUTY_PATH}/vision_hardware_control/"
        )
}

function cdpp() {
    if [[ $# -gt 0 ]]; then
        cd "$1" || exit
    else
        cd "${TENBEAUTY_PATH}/path_planner_cpp/" || exit
    fi
    conda deactivate
}
_fzf_complete_cdpp() {
    _fzf_complete +m --reverse --border --ansi \
        --preview 'exa --all --tree --level=2 --color=always --icons {}' -- "$@" < <(
            fd --type=d --hidden --max-depth=1 --no-ignore --color=always . "${TENBEAUTY_PATH}/path_planner_cpp/"
        )
}

function cdrap() {
    if [[ $# -gt 0 ]]; then
        cd "$1" || exit
    else
        cd "${TENBEAUTY_PATH}/ROM_analysis_pipeline/" || exit
    fi
    while [[ ${CONDA_SHLVL} -gt 0 ]]; do
        conda deactivate
    done
    conda deactivate
    conda activate vision_vtk
}
_fzf_complete_cdrap() {
    _fzf_complete +m --reverse --border --ansi \
        --preview 'exa --all --tree --level=2 --color=always --icons {}' -- "$@" < <(
            fd --type=d --hidden --max-depth=1 --no-ignore --color=always . "${TENBEAUTY_PATH}/ROM_analysis_pipeline/"
        )
}

##################################################
############## Function Definitions ##############
##################################################

function set-gantry() {
    if [[ $# -gt 0 ]]; then
        echo "Setting rig name as $1"
        export TEN_B_RIG_NAME=$1
    else
        if [[ -f "${HOME}/.ten_b_rig_name" ]]; then
            export TEN_B_RIG_NAME=$(<"${HOME}/.ten_b_rig_name")
        else
            export TEN_B_RIG_NAME="not_set"
        fi
        echo "No gantry specified, defaulting to ${TEN_B_RIG_NAME}"
    fi
    echo "$TEN_B_RIG_NAME" >"$HOME/.ten_b_rig_name"
}

function ppverbosefunc() {
    ppsrc_path="${HOME}/Workspace/tenbeauty/build/path_planner_cpp/src"
    cd "${ppsrc_path}" || {
        echo "${ppsrc_path} not a directory!"
        return 1
    }
    export GLOG_alsologtostderr=true
    export GLOG_stderrthreshold=0
    export GLOG_v="$1"
}

##################################################
########## Vision Environment Variables ##########
##################################################

### Hydra convenience start:
function py() { python "$@" "+setup=$TEN_B_RIG_NAME"; }

if [ -e "${HOME}/.ten_b_rig_name" ] &&
    [ -n "$(cat "${HOME}"/.ten_b_rig_name)" ]; then
    export TEN_B_RIG_NAME=$(<"${HOME}/.ten_b_rig_name")
else
    export TEN_B_RIG_NAME="not_set"
    echo $TEN_B_RIG_NAME >"${HOME}/.ten_b_rig_name"
fi

export TOTAL_LEDS=18
